.. _csharp-aggregation-sortbycount:

===========
SortByCount
===========

.. facet::
   :name: genre
   :values: reference

.. meta::
   :keywords: code example, transform, pipeline

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol


SortByCount
-----------

Use the ``sortByCount()`` method to create a :manual:`$sortByCount </reference/operator/aggregation/sortByCount/>`
pipeline stage that groups documents by a given expression and then sorts
these groups by count in descending order.

.. tip::

   The ``$sortByCount`` stage is identical to a ``$group`` stage with a
   ``$sum`` accumulator followed by a ``$sort`` stage.

   .. code-block:: json

      [
          { "$group": { "_id": <expression to group on>, "count": { "$sum": 1 } } },
          { "$sort": { "count": -1 } }
      ]

The following example groups documents by the truncated value of the field ``x``
and computes the count for each distinct value:

.. literalinclude:: /includes/aggregation/Builders.cs
   :start-after: // begin sortByCount
   :end-before: // end sortByCount
   :language: csharp
   :dedent: