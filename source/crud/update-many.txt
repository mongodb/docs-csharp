.. _csharp-update-many:

===========
Update Many
===========

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. facet::
   :name: genre
   :values: reference

.. meta::
   :keywords: synchronous, asynchronous

.. toctree::
   :caption: Update Documents

   Fields </fundamentals/crud/write-operations/update-many/fields>
   Arrays </fundamentals/crud/write-operations/update-many/arrays>

.. include:: /includes/page-templates/update/update.rst

   .. replacement:: sync-method

      ``UpdateMany()``
   
   .. replacement:: async-method

      ``UpdateManyAsync()``
   
   .. replacement:: document-or-documents

      documents
   
   .. replacement:: fields-link

      :ref:`csharp-update-many-fields`

   .. replacement:: arrays-link

      :ref:`csharp-update-many-arrays`

   .. replacement:: single-or-multiple

      multiple documents
      
   .. replacement:: usage-examples-links

      - `UpdateMany() <{+example+}/update-many/UpdateMany.cs>`__
      - `UpdateManyAsync() <{+example+}/update-many/UpdateManyAsync.cs>`__
   
   .. replacement:: sync-api-link

      `UpdateMany() <{+new-api-root+}/MongoDB.Driver/MongoDB.Driver.IMongoCollection-1.UpdateMany.html>`__

   .. replacement:: async-api-link

      `UpdateManyAsync() <{+new-api-root+}/MongoDB.Driver/MongoDB.Driver.IMongoCollection-1.UpdateManyAsync.html>`__

   .. replacement:: instruqt-lab-component

      .. instruqt:: /mongodb-docs/tracks/update-a-document---c-net-driver?token=em_69t_l-j0BC_en7Uy
         :title: UpdateManyAsync() Lesson
         :drawer:

   .. replacement:: instruqt-lab-instructions

      This page includes a short interactive lab that demonstrates how to
      modify data by using the ``UpdateManyAsync()`` method. You can complete this
      lab directly in your browser window without installing MongoDB or a code editor.
   
      To start the lab, click the :guilabel:`Open Interactive Tutorial` button at the
      top of the page. To expand the lab to a full-screen format, click the
      full-screen button (:guilabel:`â›¶`) in the top-right corner of the lab pane.
   
   .. replacement:: combine-code-example-tabs

      .. tabs::

         .. tab:: UpdateMany (Sync)
            :tabid: sync

            .. literalinclude:: /includes/code-examples/update-many/UpdateMany.cs
               :language: csharp
               :copyable: true
               :dedent:
               :start-after: // start-combine-sync
               :end-before: // end-combine-sync

         .. tab:: UpdateMany (Async)
            :tabid: async

            .. literalinclude:: /includes/code-examples/update-many/UpdateMany.cs
               :language: csharp
               :copyable: true
               :dedent:
               :start-after: // start-combine-async
               :end-before: // end-combine-async

   .. replacement:: pipeline-code-example-tabs

      .. tabs::
      
         .. tab:: UpdateMany (Sync)
            :tabid: sync
      
            .. literalinclude:: /includes/code-examples/update-many/UpdateMany.cs
               :language: csharp
               :copyable: true
               :dedent:
               :start-after: // start-pipeline-sync
               :end-before: // end-pipeline-sync
      
         .. tab:: UpdateMany (Async)
            :tabid: async
      
            .. literalinclude:: /includes/code-examples/update-many/UpdateMany.cs
               :language: csharp
               :copyable: true
               :dedent:
               :start-after: // start-pipeline-async
               :end-before: // end-pipeline-async

.. TODO: integrate into existing page

Sample Class
------------

The code examples in this guide demonstrate how you can use builders to
create types to interact with documents in the sample collection ``plants.flowers``.
Documents in this collection are modeled by the following ``Flower`` class:

.. literalinclude:: /includes/fundamentals/code-examples/builders.cs
   :language: csharp
   :dedent:
   :start-after: start-model
   :end-before: end-model

Each builder class takes a generic type parameter
``TDocument`` which represents the type of document that you are working
with. In this guide, the ``Flower`` class is the document type used in
each builder class example.

Define an Update
----------------

The ``UpdateDefinitionBuilder`` class provides a type-safe interface for
building up an update specification. Suppose you want to create an
update specification with the following criteria:

- Create the new field ``SunRequirement``
- Multiply the ``Price`` field value by 0.9

Use builders to create the update specification with the typed variant:

.. code-block:: csharp
   :copyable: true

   var builder = Builders<Flower>.Update;
   var update = builder.Set(f => f.SunRequirement, "Full sun").Mul(f => f.Price, 0.9);

Alternatively, you can use string-based field names to define the update:
   
.. code-block:: csharp
   :copyable: true

   var builder = Builders<Flower>.Update;
   var update = builder.Set("SunRequirement", "Full sun").Mul("Price", 0.9);  

- `UpdateDefinitionBuilder <{+new-api-root+}/MongoDB.Driver/MongoDB.Driver.UpdateDefinitionBuilder-1.html>`__