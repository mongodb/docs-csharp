.. _csharp-stable-api:

==============
{+stable-api+}
==============

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

   .. note::

   The {+stable-api+} feature requires MongoDB Server 5.0 or later.

   You should use the {+stable-api+} feature only if all the MongoDB
   servers you're connecting to support this feature.

Overview
--------

When a MongoDB server runs an operation, it uses the version of the operation defined by
the current *API version*. When you update either your driver or server, it changes 
the API version, which can change the way these operations behave.

The **{+stable-api+}** feature forces the server to run operations according to the
API version you specify. This ensures consistent responses from the server and 
provides long-term API stability for your application.

The following sections describe how you can enable and customize {+stable-api+} for
your MongoDB client.
    
For more information about {+stable-api+}, including a list of the commands it covers,
see the :manual:`MongoDB reference page. </reference/stable-api/>`

Enable the {+stable-api+} on a MongoDB Client
---------------------------------------------

To enable the {+stable-api+}, you must specify an API version in the settings
of your MongoDB client. Once you instantiate a ``MongoClient`` instance with
a specified API version, all commands you run with the client use that
version of the {+stable-api+}.

.. tip::

   Once you've created a ``MongoClient``, you can't change its {+stable-api+} version.  
   If you need to run commands using more than one version of the 
   {+stable-api+}, instantiate a separate client with that version.

   If you need to run commands not covered by the {+stable-api+}, make sure the
   "strict" option is disabled. See the section on
   :ref:`{+stable-api+} Options <stable-api-options>` for more information.

The following example shows how you can instantiate a ``MongoClient`` that
sets the {+stable-api+} version and connects to a server by performing the
following operations:

- Construct a ``ServerApi`` instance and specify a {+stable-api+} version 
  using a static property of the ``ServerApiVersion`` class.
- Construct a ``MongoClientSettings`` instance and set the ``ServerApi`` property.
- Create a ``MongoClient`` and pass the ``MongoClientSettings`` object as an argument.

.. literalinclude:: /includes/fundamentals/code-examples/StableApi.cs
   :start-after: start-stable-api
   :end-before: end-stable-api
   :language: csharp
   :dedent:

.. warning::

   If you specify an API version and connect to a MongoDB server that does
   not support the {+stable-api+}, your app might raise an exception when
   executing a command on your MongoDB server. If you use a ``MongoClient``
   that specifies the API version to query a server that doesn't support it,
   your query could fail with an exception message that includes the
   following text:

   .. code-block:: none
      :copyable: false

      'Unrecognized field 'apiVersion' on server...

.. _stable-api-options:

{+stable-api+} Options
--------------------------

You can use the options in the following table to customize the behavior of the 
{+stable-api+}.

.. list-table::
   :header-rows: 1
   :stub-columns: 1
   :widths: 25,75

   * - Option Name
     - Description

   * - Strict
     - | **Optional**. When ``true``, if you call a command that is not part of 
         the declared API version, the driver raises an exception.
       |
       | Default: **false**

   * -  DeprecationErrors
     - | **Optional**. When ``true``, if you call a command that is deprecated in the 
         declared API version, the driver raises an exception.
       |
       | Default: **false**

The following example shows how you can set these options when constructing a 
``ServerApi`` object:

.. literalinclude:: /includes/fundamentals/code-examples/StableApi.cs
   :start-after: start-stable-api-options
   :end-before: end-stable-api-options
   :language: csharp
   :dedent:

API Documentation
-----------------

For more information on using the {+stable-api+} with the {+driver-long+}, see the 
following API documentation: 

- `ServerApi <{+api-root+}/T_MongoDB_Driver_ServerApi.htm>`__

