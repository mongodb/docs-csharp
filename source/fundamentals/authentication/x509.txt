.. _csharp-authentication-x509:

=====
X.509
=====

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. facet::
   :name: genre
   :values: reference

.. meta::
   :keywords: .NET, certificate, code example

Overview
--------

In the **X.509** authentication mechanism, the server and client use the
:wikipedia:`TLS <Transport_Layer_Security>` protocol to exchange X.509 public-key
certificates. You can use X.509 certificates to authenticate to MongoDB Atlas, MongoDB
Enterprise Advanced, and MongoDB Community Edition.

.. tip:: X.509 Mechanism

   To learn how to use TLS/SSL with the {+driver-short+},
   see :ref:`TLS/SSL <csharp-tls>`.

   For more information about X.509 certificates, see
   :ref:`X.509 <x509-client-authentication>` in the {+mdb-server+} manual.

Code Placeholders 
~~~~~~~~~~~~~~~~~

.. include:: /includes/auth-placeholders.rst

Using X.509 Authentication in Your Application
----------------------------------------------

To use an X.509 certificate for authentication, you must use a
``MongoClientSettings`` object to specify
the path to your X.509 certificate and the password for the certificate. The certificate
must use the :wikipedia:`PKCS #12<PKCS_12>` (``.p12``) or
:wikipedia:`PEM<Privacy-Enhanced_Mail>` (``.pem``) format.

You must also specify ``MONGODB-X509`` as the authentication mechanism. You can specify
this mechanism either in your connection string or by using a ``MongoCredential`` object. 
Select the :guilabel:`Connection String` or :guilabel:`MongoCredential` tab to
see the corresponding syntax:

.. tabs::

   .. tab:: Connection String
      :tabid: default-connection-string

      .. code-block:: csharp

         var connectionString = "mongodb://<hostname>/?authMechanism=MONGODB-X509";
         var settings = MongoClientSettings.FromConnectionString(connectionString);

         settings.UseTls = true;
         settings.SslSettings = new SslSettings
         {
            ClientCertificates = new List<X509Certificate>()
            {
                new X509Certificate2("/path/to/X.509/certificate", "<X.509 certificate password>")
            }
         };

   .. tab:: MongoCredential
      :tabid: default-mongo-credential

      .. code-block:: csharp

         var credential = MongoCredential.CreateMongoX509Credential("<X.509 certificate username>")
         var settings = new MongoClientSettings 
         {
             Credential =  credential,
             SslSettings = new SslSettings
             {
                 ClientCertificates = new List<X509Certificate>()
                 {
                     new X509Certificate2("/path/to/X.509/certificate", "<X.509 certificate password>")
                 },
             },
             UseTls = true,
             Server = new MongoServerAddress("<hostname>", "<port>"),
         };

      .. note:: Certificate Username

         If you pass your X.509 certificate username to the ``CreateMongoX509Credential()``
         method, it must match the distinguished subject name of your X.509 certificate.
         If you pass ``null`` to this method, the MongoDB deployment uses your
         X.509 certificate to infer your username.

.. note::

   If you are using Windows, the driver might be unable to locate an ``X.509``
   authentication certificate created in memory. To learn more about a potential solution to
   this issue, see the :ref:`csharp-troubleshooting-connection-X509`
   section of the Connection Troubleshooting guide.

API Documentation
-----------------

To learn more about any of the MongoDB methods and types used on this
page, see the following API documentation:

- `MongoClient() <{+new-api-root+}/MongoDB.Driver/MongoDB.Driver.MongoClient.html>`__
- `MongoClientSettings() <{+new-api-root+}/MongoDB.Driver/MongoDB.Driver.MongoClientSettings.html>`__
- `MongoCredential() <{+new-api-root+}/MongoDB.Driver/MongoDB.Driver.MongoCredential.html>`__
- `CreateMongoX509Credential() <{+new-api-root+}/MongoDB.Driver/MongoDB.Driver.MongoCredential.CreateMongoX509Credential.html>`__
- `SslSettings() <{+new-api-root+}/MongoDB.Driver/MongoDB.Driver.SslSettings.html>`__
- `MongoServerAddress() <{+new-api-root+}/MongoDB.Driver/MongoDB.Driver.MongoServerAddress.html>`__

For more information about the .NET types used on this page, see the
following MSDN documentation:

- `X509Certificate() <https://docs.microsoft.com/dotnet/api/system.security.cryptography.x509certificates.x509certificate>`__
- `X509Certificate2() <https://docs.microsoft.com/dotnet/api/system.security.cryptography.x509certificates.x509certificate2>`__

